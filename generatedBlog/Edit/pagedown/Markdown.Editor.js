(function(){var t={},j={},q={},e=window.document,m=window.RegExp,h=window.navigator,n={lineLength:72},p={isIE:/msie/.test(h.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(h.userAgent.toLowerCase())||/msie 5/.test(h.userAgent.toLowerCase()),isOpera:/opera/.test(h.userAgent.toLowerCase())};var d={bold:"Strong <strong> Ctrl+B",boldexample:"strong text",italic:"Emphasis <em> Ctrl+I",italicexample:"emphasized text",link:"Hyperlink <a> Ctrl+L",linkdescription:"enter link description here",linkdialog:'<p><b>Insert Hyperlink</b></p><p>http://example.com/ "optional title"</p>',quote:"Blockquote <blockquote> Ctrl+Q",quoteexample:"Blockquote",code:"Code Sample <pre><code> Ctrl+K",codeexample:"enter code here",image:"Image <img> Ctrl+G",imagedescription:"enter image description here",imagedialog:"<p><b>Insert Image</b></p><p>http://example.com/images/diagram.jpg \"optional title\"<br><br>Need <a href='http://www.google.com/search?q=free+image+hosting' target='_blank'>free image hosting?</a></p>",olist:"Numbered List <ol> Ctrl+O",ulist:"Bulleted List <ul> Ctrl+U",litem:"List item",heading:"Heading <h1>/<h2> Ctrl+H",headingexample:"Heading",hr:"Horizontal Rule <hr> Ctrl+R",undo:"Undo - Ctrl+Z",redo:"Redo - Ctrl+Y",redomac:"Redo - Ctrl+Shift+Z",help:"Markdown Editing Help"};var f="http://";var g="http://";Markdown.Editor=function(x,w,y){y=y||{};if(typeof y.handler==="function"){y={helpButton:y}}y.strings=y.strings||{};if(y.helpButton){y.strings.help=y.strings.help||y.helpButton.title}var u=function(B){return y.strings[B]||d[B]};w=w||"";var v=this.hooks=new Markdown.HookCollection();v.addNoop("onPreviewRefresh");v.addNoop("postBlockquoteCreation");v.addFalse("insertImageDialog");this.getConverter=function(){return x};var A=this,z;this.run=function(){if(z){return}z=new i(w);var B=new b(v,u);var D=new k(x,z,function(){v.onPreviewRefresh()});var F,E;if(!/\?noundo/.test(e.location.href)){F=new s(function(){D.refresh();if(E){E.setUndoRedoButtonStates()}},z);this.textOperation=function(G){F.setCommandMode();G();A.refreshPreview()}}E=new r(w,z,F,D,B,y.helpButton,u);E.setUndoRedoButtonStates();var C=A.refreshPreview=function(){D.refresh(true)};C()}};function a(){}a.prototype.findTags=function(x,v){var u=this;var w;if(x){w=t.extendRegExp(x,"","$");this.before=this.before.replace(w,function(y){u.startTag=u.startTag+y;return""});w=t.extendRegExp(x,"^","");this.selection=this.selection.replace(w,function(y){u.startTag=u.startTag+y;return""})}if(v){w=t.extendRegExp(v,"","$");this.selection=this.selection.replace(w,function(y){u.endTag=y+u.endTag;return""});w=t.extendRegExp(v,"^","");this.after=this.after.replace(w,function(y){u.endTag=y+u.endTag;return""})}};a.prototype.trimWhitespace=function(w){var v,u,x=this;if(w){v=u=""}else{v=function(y){x.before+=y;return""};u=function(y){x.after=y+x.after;return""}}this.selection=this.selection.replace(/^(\s*)/,v).replace(/(\s*)$/,u)};a.prototype.skipLines=function(w,v,u){if(w===undefined){w=1}if(v===undefined){v=1}w++;v++;var x;var y;if(navigator.userAgent.match(/Chrome/)){"X".match(/()./)}this.selection=this.selection.replace(/(^\n*)/,"");this.startTag=this.startTag+m.$1;this.selection=this.selection.replace(/(\n*$)/,"");this.endTag=this.endTag+m.$1;this.startTag=this.startTag.replace(/(^\n*)/,"");this.before=this.before+m.$1;this.endTag=this.endTag.replace(/(\n*$)/,"");this.after=this.after+m.$1;if(this.before){x=y="";while(w--){x+="\\n?";y+="\n"}if(u){x="\\n*"}this.before=this.before.replace(new m(x+"$",""),y)}if(this.after){x=y="";while(v--){x+="\\n?";y+="\n"}if(u){x="\\n*"}this.after=this.after.replace(new m(x,""),y)}};function i(u){this.buttonBar=e.getElementById("wmd-button-bar"+u);this.preview=e.getElementById("wmd-preview"+u);this.input=e.getElementById("wmd-input"+u)}t.isVisible=function(u){if(window.getComputedStyle){return window.getComputedStyle(u,null).getPropertyValue("display")!=="none"}else{if(u.currentStyle){return u.currentStyle.display!=="none"}}};t.addEvent=function(u,v,w){if(u.attachEvent){u.attachEvent("on"+v,w)}else{u.addEventListener(v,w,false)}};t.removeEvent=function(u,v,w){if(u.detachEvent){u.detachEvent("on"+v,w)}else{u.removeEventListener(v,w,false)}};t.fixEolChars=function(u){u=u.replace(/\r\n/g,"\n");u=u.replace(/\r/g,"\n");return u};t.extendRegExp=function(y,x,w){if(x===null||x===undefined){x=""}if(w===null||w===undefined){w=""}var v=y.toString();var u;v=v.replace(/\/([gim]*)$/,function(A,z){u=z;return""});v=v.replace(/(^\/|\/$)/g,"");v=x+v+w;return new m(v,u)};j.getTop=function(u,v){var w=u.offsetTop;if(!v){while(u=u.offsetParent){w+=u.offsetTop}}return w};j.getHeight=function(u){return u.offsetHeight||u.scrollHeight};j.getWidth=function(u){return u.offsetWidth||u.scrollWidth};j.getPageSize=function(){var z,y;var v,u;if(self.innerHeight&&self.scrollMaxY){z=e.body.scrollWidth;y=self.innerHeight+self.scrollMaxY}else{if(e.body.scrollHeight>e.body.offsetHeight){z=e.body.scrollWidth;y=e.body.scrollHeight}else{z=e.body.offsetWidth;y=e.body.offsetHeight}}if(self.innerHeight){v=self.innerWidth;u=self.innerHeight}else{if(e.documentElement&&e.documentElement.clientHeight){v=e.documentElement.clientWidth;u=e.documentElement.clientHeight}else{if(e.body){v=e.body.clientWidth;u=e.body.clientHeight}}}var x=Math.max(z,v);var w=Math.max(y,u);return[x,w,v,u]};function s(u,B){var I=this;var J=[];var G=0;var A="none";var z;var H;var y;var F=function(K,L){if(A!=K){A=K;if(!L){D()}}if(!p.isIE||A!="moving"){H=setTimeout(C,1)}else{y=null}};var C=function(K){y=new o(B,K);H=undefined};this.setCommandMode=function(){A="command";D();H=setTimeout(C,0)};this.canUndo=function(){return G>1};this.canRedo=function(){if(J[G+1]){return true}return false};this.undo=function(){if(I.canUndo()){if(z){z.restore();z=null}else{J[G]=new o(B);J[--G].restore();if(u){u()}}}A="none";B.input.focus();C()};this.redo=function(){if(I.canRedo()){J[++G].restore();if(u){u()}}A="none";B.input.focus();C()};var D=function(){var K=y||new o(B);if(!K){return false}if(A=="moving"){if(!z){z=K}return}if(z){if(J[G-1].text!=z.text){J[G++]=z}z=null}J[G++]=K;J[G+1]=null;if(u){u()}};var v=function(K){var L=false;if((K.ctrlKey||K.metaKey)&&!K.altKey){var M=K.charCode||K.keyCode;var N=String.fromCharCode(M);switch(N.toLowerCase()){case"y":I.redo();L=true;break;case"z":if(!K.shiftKey){I.undo()}else{I.redo()}L=true;break}}if(L){if(K.preventDefault){K.preventDefault()}if(window.event){window.event.returnValue=false}return}};var w=function(K){if(!K.ctrlKey&&!K.metaKey){var L=K.keyCode;if((L>=33&&L<=40)||(L>=63232&&L<=63235)){F("moving")}else{if(L==8||L==46||L==127){F("deleting")}else{if(L==13){F("newlines")}else{if(L==27){F("escape")}else{if((L<16||L>20)&&L!=91){F("typing")}}}}}}};var E=function(){t.addEvent(B.input,"keypress",function(L){if((L.ctrlKey||L.metaKey)&&!L.altKey&&(L.keyCode==89||L.keyCode==90)){L.preventDefault()}});var K=function(){if(p.isIE||(y&&y.text!=B.input.value)){if(H==undefined){A="paste";D();C()}}};t.addEvent(B.input,"keydown",v);t.addEvent(B.input,"keydown",w);t.addEvent(B.input,"mousedown",function(){F("moving")});B.input.onpaste=K;B.input.ondrop=K};var x=function(){E();C(true);D()};x()}function o(w,v){var x=this;var u=w.input;this.init=function(){if(!t.isVisible(u)){return}if(!v&&e.activeElement&&e.activeElement!==u){return}this.setInputAreaSelectionStartEnd();this.scrollTop=u.scrollTop;if(!this.text&&u.selectionStart||u.selectionStart===0){this.text=u.value}};this.setInputAreaSelection=function(){if(!t.isVisible(u)){return}if(u.selectionStart!==undefined&&!p.isOpera){u.focus();u.selectionStart=x.start;u.selectionEnd=x.end;u.scrollTop=x.scrollTop}else{if(e.selection){if(e.activeElement&&e.activeElement!==u){return}u.focus();var y=u.createTextRange();y.moveStart("character",-u.value.length);y.moveEnd("character",-u.value.length);y.moveEnd("character",x.end);y.moveStart("character",x.start);y.select()}}};this.setInputAreaSelectionStartEnd=function(){if(!w.ieCachedRange&&(u.selectionStart||u.selectionStart===0)){x.start=u.selectionStart;x.end=u.selectionEnd}else{if(e.selection){x.text=t.fixEolChars(u.value);var D=w.ieCachedRange||e.selection.createRange();var y=t.fixEolChars(D.text);var C="\x07";var B=C+y+C;D.text=B;var z=t.fixEolChars(u.value);D.moveStart("character",-B.length);D.text=y;x.start=z.indexOf(C);x.end=z.lastIndexOf(C)-C.length;var A=x.text.length-t.fixEolChars(u.value).length;if(A){D.moveStart("character",-y.length);while(A--){y+="\n";x.end+=1}D.text=y}if(w.ieCachedRange){x.scrollTop=w.ieCachedScrollTop}w.ieCachedRange=null;this.setInputAreaSelection()}}};this.restore=function(){if(x.text!=undefined&&x.text!=u.value){u.value=x.text}this.setInputAreaSelection();u.scrollTop=x.scrollTop};this.getChunks=function(){var y=new a();y.before=t.fixEolChars(x.text.substring(0,x.start));y.startTag="";y.selection=t.fixEolChars(x.text.substring(x.start,x.end));y.endTag="";y.after=t.fixEolChars(x.text.substring(x.end));y.scrollTop=x.scrollTop;return y};this.setChunks=function(y){y.before=y.before+y.startTag;y.after=y.endTag+y.after;this.start=y.before.length;this.end=y.before.length+y.selection.length;this.text=y.before+y.selection+y.after;this.scrollTop=y.scrollTop};this.init()}function k(v,H,I){var D=this;var P;var w;var G;var E=3000;var O="delayed";var N=function(Q,R){t.addEvent(Q,"input",R);Q.onpaste=R;Q.ondrop=R;t.addEvent(Q,"keypress",R);t.addEvent(Q,"keydown",R)};var x=function(){var Q=0;if(window.innerHeight){Q=window.pageYOffset}else{if(e.documentElement&&e.documentElement.scrollTop){Q=e.documentElement.scrollTop}else{if(e.body){Q=e.body.scrollTop}}}return Q};var C=function(){if(!H.preview){return}var S=H.input.value;if(S&&S==G){return}else{G=S}var R=new Date().getTime();S=v.makeHtml(S);var Q=new Date().getTime();w=Q-R;L(S)};var u=function(){if(P){clearTimeout(P);P=undefined}if(O!=="manual"){var Q=0;if(O==="delayed"){Q=w}if(Q>E){Q=E}P=setTimeout(C,Q)}};var y=function(Q){if(Q.scrollHeight<=Q.clientHeight){return 1}return Q.scrollTop/(Q.scrollHeight-Q.clientHeight)};var M=function(){if(H.preview){H.preview.scrollTop=(H.preview.scrollHeight-H.preview.clientHeight)*y(H.preview)}};this.refresh=function(Q){if(Q){G="";C()}else{u()}};this.processingTime=function(){return w};var B=true;var z=function(T){var R=H.preview;var Q=R.parentNode;var S=R.nextSibling;Q.removeChild(R);R.innerHTML=T;if(!S){Q.appendChild(R)}else{Q.insertBefore(R,S)}};var F=function(Q){H.preview.innerHTML=Q};var K;var J=function(R){if(K){return K(R)}try{F(R);K=F}catch(Q){K=z;K(R)}};var L=function(S){var Q=j.getTop(H.input)-x();if(H.preview){J(S);I()}M();if(B){B=false;return}var R=j.getTop(H.input)-x();if(p.isIE){setTimeout(function(){window.scrollBy(0,R-Q)},0)}else{window.scrollBy(0,R-Q)}};var A=function(){N(H.input,u);C();if(H.preview){H.preview.scrollTop=0}};A()}q.createBackground=function(){var u=e.createElement("div"),w=u.style;u.className="wmd-prompt-background";w.position="absolute";w.top="0";w.zIndex="1000";if(p.isIE){w.filter="alpha(opacity=50)"}else{w.opacity="0.5"}var v=j.getPageSize();w.height=v[1]+"px";if(p.isIE){w.left=e.documentElement.scrollLeft;w.width=e.documentElement.clientWidth}else{w.left="0";w.width="100%"}e.body.appendChild(u);return u};q.prompt=function(B,y,u){var z;var A;if(y===undefined){y=""}var v=function(D){var C=(D.charCode||D.keyCode);if(C===27){w(true)}};var w=function(C){t.removeEvent(e.body,"keydown",v);var D=A.value;if(C){D=null}else{D=D.replace(/^http:\/\/(https?|ftp):\/\//,"$1://");if(!/^(?:https?|ftp):\/\//.test(D)){D="http://"+D}}z.parentNode.removeChild(z);u(D);return false};var x=function(){z=e.createElement("div");z.className="wmd-prompt-dialog";z.style.padding="10px;";z.style.position="fixed";z.style.width="400px";z.style.zIndex="1001";var F=e.createElement("div");F.innerHTML=B;F.style.padding="5px";z.appendChild(F);var D=e.createElement("form"),G=D.style;D.onsubmit=function(){return w(false)};G.padding="0";G.margin="0";G.cssFloat="left";G.width="100%";G.textAlign="center";G.position="relative";z.appendChild(D);A=e.createElement("input");A.type="text";A.value=y;G=A.style;G.display="block";G.width="80%";G.marginLeft=G.marginRight="auto";D.appendChild(A);var E=e.createElement("input");E.type="button";E.onclick=function(){return w(false)};E.value="OK";G=E.style;G.margin="10px";G.display="inline";G.width="7em";var C=e.createElement("input");C.type="button";C.onclick=function(){return w(true)};C.value="Cancel";G=C.style;G.margin="10px";G.display="inline";G.width="7em";D.appendChild(E);D.appendChild(C);t.addEvent(e.body,"keydown",v);z.style.top="50%";z.style.left="50%";z.style.display="block";if(p.isIE_5or6){z.style.position="absolute";z.style.top=e.documentElement.scrollTop+200+"px";z.style.left="50%"}e.body.appendChild(z);z.style.marginTop=-(j.getHeight(z)/2)+"px";z.style.marginLeft=-(j.getWidth(z)/2)+"px"};setTimeout(function(){x();var C=y.length;if(A.selectionStart!==undefined){A.selectionStart=0;A.selectionEnd=C}else{if(A.createTextRange){var D=A.createTextRange();D.collapse(false);D.moveStart("character",-C);D.moveEnd("character",C);D.select()}}A.focus()},0)};function r(E,D,I,F,w,z,y){var A=D.input,v={};C();var B="keydown";if(p.isOpera){B="keypress"}t.addEvent(A,B,function(J){if((J.ctrlKey||J.metaKey)&&!J.altKey&&!J.shiftKey){var K=J.charCode||J.keyCode;var L=String.fromCharCode(K).toLowerCase();switch(L){case"b":x(v.bold);break;case"i":x(v.italic);break;case"l":x(v.link);break;case"q":x(v.quote);break;case"k":x(v.code);break;case"g":x(v.image);break;case"o":x(v.olist);break;case"u":x(v.ulist);break;case"h":x(v.heading);break;case"r":x(v.hr);break;case"y":x(v.redo);break;case"z":if(J.shiftKey){x(v.redo)}else{x(v.undo)}break;default:return}if(J.preventDefault){J.preventDefault()}if(window.event){window.event.returnValue=false}}});t.addEvent(A,"keyup",function(K){if(K.shiftKey&&!K.ctrlKey&&!K.metaKey){var L=K.charCode||K.keyCode;if(L===13){var J={};J.textOp=u("doAutoindent");x(J)}}});if(p.isIE){t.addEvent(A,"keydown",function(K){var J=K.keyCode;if(J===27){return false}})}function x(J){A.focus();if(J.textOp){if(I){I.setCommandMode()}var N=new o(D);if(!N){return}var K=N.getChunks();var L=function(){A.focus();if(K){N.setChunks(K)}N.restore();F.refresh()};var M=J.textOp(K,L);if(!M){L()}}if(J.execute){J.execute(I)}}function H(J,N){var O="0px";var K="-20px";var L="-40px";var M=J.getElementsByTagName("span")[0];if(N){M.style.backgroundPosition=J.XShift+" "+O;J.onmouseover=function(){M.style.backgroundPosition=this.XShift+" "+L};J.onmouseout=function(){M.style.backgroundPosition=this.XShift+" "+O};if(p.isIE){J.onmousedown=function(){if(e.activeElement&&e.activeElement!==D.input){return}D.ieCachedRange=document.selection.createRange();D.ieCachedScrollTop=D.input.scrollTop}}if(!J.isHelp){J.onclick=function(){if(this.onmouseout){this.onmouseout()}x(this);return false}}}else{M.style.backgroundPosition=J.XShift+" "+K;J.onmouseover=J.onmouseout=J.onclick=function(){}}}function u(J){if(typeof J==="string"){J=w[J]}return function(){J.apply(w,arguments)}}function C(){var J=D.buttonBar;var R="0px";var L="-20px";var O="-40px";var K=document.createElement("ul");K.id="wmd-button-row"+E;K.className="wmd-button-row";K=J.appendChild(K);var T=0;var P=function(W,Y,Z,X){var U=document.createElement("li");U.className="wmd-button";U.style.left=T+"px";T+=25;var V=document.createElement("span");U.id=W+E;U.appendChild(V);U.title=Y;U.XShift=Z;if(X){U.textOp=X}H(U,true);K.appendChild(U);return U};var Q=function(U){var V=document.createElement("li");V.className="wmd-spacer wmd-spacer"+U;V.id="wmd-spacer"+U+E;K.appendChild(V);T+=25};v.bold=P("wmd-bold-button",y("bold"),"0px",u("doBold"));v.italic=P("wmd-italic-button",y("italic"),"-20px",u("doItalic"));Q(1);v.link=P("wmd-link-button",y("link"),"-40px",u(function(U,V){return this.doLinkOrImage(U,V,false)}));v.quote=P("wmd-quote-button",y("quote"),"-60px",u("doBlockquote"));v.code=P("wmd-code-button",y("code"),"-80px",u("doCode"));v.image=P("wmd-image-button",y("image"),"-100px",u(function(U,V){return this.doLinkOrImage(U,V,true)}));Q(2);v.olist=P("wmd-olist-button",y("olist"),"-120px",u(function(U,V){this.doList(U,V,true)}));v.ulist=P("wmd-ulist-button",y("ulist"),"-140px",u(function(U,V){this.doList(U,V,false)}));v.heading=P("wmd-heading-button",y("heading"),"-160px",u("doHeading"));v.hr=P("wmd-hr-button",y("hr"),"-180px",u("doHorizontalRule"));Q(3);v.undo=P("wmd-undo-button",y("undo"),"-200px",null);v.undo.execute=function(U){if(U){U.undo()}};var S=/win/.test(h.platform.toLowerCase())?y("redo"):y("redomac");v.redo=P("wmd-redo-button",S,"-220px",null);v.redo.execute=function(U){if(U){U.redo()}};if(z){var M=document.createElement("li");var N=document.createElement("span");M.appendChild(N);M.className="wmd-button wmd-help-button";M.id="wmd-help-button"+E;M.XShift="-240px";M.isHelp=true;M.style.right="0px";M.title=y("help");M.onclick=z.handler;H(M,true);K.appendChild(M);v.help=M}G()}function G(){if(I){H(v.undo,I.canUndo());H(v.redo,I.canRedo())}}this.setUndoRedoButtonStates=G}function b(v,u){this.hooks=v;this.getString=u}var c=b.prototype;c.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)";c.unwrap=function(u){var v=new m("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");u.selection=u.selection.replace(v,"$1 $2")};c.wrap=function(u,v){this.unwrap(u);var w=new m("(.{1,"+v+"})( +|$\\n?)","gm"),x=this;u.selection=u.selection.replace(w,function(y,z){if(new m("^"+x.prefixes,"").test(y)){return y}return z+"\n"});u.selection=u.selection.replace(/\s+$/,"")};c.doBold=function(u,v){return this.doBorI(u,v,2,this.getString("boldexample"))};c.doItalic=function(u,v){return this.doBorI(u,v,1,this.getString("italicexample"))};c.doBorI=function(u,y,x,v){u.trimWhitespace();u.selection=u.selection.replace(/\n{2,}/g,"\n");var B=/(\**$)/.exec(u.before)[0];var A=/(^\**)/.exec(u.after)[0];var z=Math.min(B.length,A.length);if((z>=x)&&(z!=2||x!=1)){u.before=u.before.replace(m("[*]{"+x+"}$",""),"");u.after=u.after.replace(m("^[*]{"+x+"}",""),"")}else{if(!u.selection&&A){u.after=u.after.replace(/^([*_]*)/,"");u.before=u.before.replace(/(\s?)$/,"");var C=m.$1;u.before=u.before+A+C}else{if(!u.selection&&!A){u.selection=v}var w=x<=1?"*":"**";u.before=u.before+w;u.after=w+u.after}}return};c.stripLinkDefs=function(v,u){v=v.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(A,w,x,y,z){u[w]=A.replace(/\s*$/,"");if(y){u[w]=A.replace(/["(](.+?)[")]$/,"");return y+z}return""});return v};c.addLinkDef=function(v,z){var A=0;var x={};v.before=this.stripLinkDefs(v.before,x);v.selection=this.stripLinkDefs(v.selection,x);v.after=this.stripLinkDefs(v.after,x);var w="";var C=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g;var u=function(D){A++;D=D.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+A+"]:");w+="\n"+D};var y=function(I,E,H,D,G,F){H=H.replace(C,y);if(x[G]){u(x[G]);return E+H+D+A+F}return I};v.before=v.before.replace(C,y);if(z){u(z)}else{v.selection=v.selection.replace(C,y)}var B=A;v.after=v.after.replace(C,y);if(v.after){v.after=v.after.replace(/\n*$/,"")}if(!v.after){v.selection=v.selection.replace(/\n*$/,"")}v.after+="\n\n"+w;return B};function l(u){return u.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(x,v,w){v=v.replace(/\?.*$/,function(y){return y.replace(/\+/g," ")});v=decodeURIComponent(v);v=encodeURI(v).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29");v=v.replace(/\?.*$/,function(y){return y.replace(/\+/g,"%2b")});if(w){w=w.trim?w.trim():w.replace(/^\s*/,"").replace(/\s*$/,"");w=w.replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return w?v+' "'+w+'"':v})}c.doLinkOrImage=function(v,y,w){v.trimWhitespace();v.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);var u;if(v.endTag.length>1&&v.startTag.length>0){v.startTag=v.startTag.replace(/!?\[/,"");v.endTag="";this.addLinkDef(v,null)}else{v.selection=v.startTag+v.selection+v.endTag;v.startTag=v.endTag="";if(/\n\n/.test(v.selection)){this.addLinkDef(v,null);return}var z=this;var x=function(A){u.parentNode.removeChild(u);if(A!==null){v.selection=(" "+v.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var B=" [999]: "+l(A);var C=z.addLinkDef(v,B);v.startTag=w?"![":"[";v.endTag="]["+C+"]";if(!v.selection){if(w){v.selection=z.getString("imagedescription")}else{v.selection=z.getString("linkdescription")}}}y()};u=q.createBackground();if(w){if(!this.hooks.insertImageDialog(x)){q.prompt(this.getString("imagedialog"),f,x)}}else{q.prompt(this.getString("linkdialog"),g,x)}return true}};c.doAutoindent=function(u,x){var v=this,w=false;u.before=u.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n");u.before=u.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n");u.before=u.before.replace(/(\n|^)[ \t]+\n$/,"\n\n");if(!u.selection&&!/^[ \t]*(?:\n|$)/.test(u.after)){u.after=u.after.replace(/^[^\n]*/,function(y){u.selection=y;return""});w=true}if(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(u.before)){if(v.doList){v.doList(u)}}if(/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(u.before)){if(v.doBlockquote){v.doBlockquote(u)}}if(/(\n|^)(\t|[ ]{4,}).*\n$/.test(u.before)){if(v.doCode){v.doCode(u)}}if(w){u.after=u.selection+u.after;u.selection=""}};c.doBlockquote=function(u,C){u.selection=u.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(H,F,G,E){u.before+=F;u.after=E+u.after;return G});u.before=u.before.replace(/(>[ \t]*)$/,function(F,E){u.selection=E+u.selection;return""});u.selection=u.selection.replace(/^(\s|>)+$/,"");u.selection=u.selection||this.getString("quoteexample");var B="",y="",z;if(u.before){var A=u.before.replace(/\n$/,"").split("\n");var x=false;for(var w=0;w<A.length;w++){var v=false;z=A[w];x=x&&z.length>0;if(/^>/.test(z)){v=true;if(!x&&z.length>1){x=true}}else{if(/^[ \t]*$/.test(z)){v=true}else{v=x}}if(v){B+=z+"\n"}else{y+=B+z;B="\n"}}if(!/(^|\n)>/.test(B)){y+=B;B=""}}u.startTag=B;u.before=y;if(u.after){u.after=u.after.replace(/^\n?/,"\n")}u.after=u.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(E){u.endTag=E;return""});var D=function(F){var E=F?"> ":"";if(u.startTag){u.startTag=u.startTag.replace(/\n((>|\s)*)\n$/,function(H,G){return"\n"+G.replace(/^[ ]{0,3}>?[ \t]*$/gm,E)+"\n"})}if(u.endTag){u.endTag=u.endTag.replace(/^\n((>|\s)*)\n/,function(H,G){return"\n"+G.replace(/^[ ]{0,3}>?[ \t]*$/gm,E)+"\n"})}};if(/^(?![ ]{0,3}>)/m.test(u.selection)){this.wrap(u,n.lineLength-2);u.selection=u.selection.replace(/^/gm,"> ");D(true);u.skipLines()}else{u.selection=u.selection.replace(/^[ ]{0,3}> ?/gm,"");this.unwrap(u);D(false);if(!/^(\n|^)[ ]{0,3}>/.test(u.selection)&&u.startTag){u.startTag=u.startTag.replace(/\n{0,2}$/,"\n\n")}if(!/(\n|^)[ ]{0,3}>.*$/.test(u.selection)&&u.endTag){u.endTag=u.endTag.replace(/^\n{0,2}/,"\n\n")}}u.selection=this.hooks.postBlockquoteCreation(u.selection);if(!/\n/.test(u.selection)){u.selection=u.selection.replace(/^(> *)/,function(F,E){u.startTag+=E;return""})}};c.doCode=function(u,z){var w=/\S[ ]*$/.test(u.before);var v=/^[ ]*\S/.test(u.after);if((!v&&!w)||/\n/.test(u.selection)){u.before=u.before.replace(/[ ]{4}$/,function(A){u.selection=A+u.selection;return""});var x=1;var y=1;if(/(\n|^)(\t|[ ]{4,}).*\n$/.test(u.before)){x=0}if(/^\n(\t|[ ]{4,})/.test(u.after)){y=0}u.skipLines(x,y);if(!u.selection){u.startTag="    ";u.selection=this.getString("codeexample")}else{if(/^[ ]{0,3}\S/m.test(u.selection)){if(/\n/.test(u.selection)){u.selection=u.selection.replace(/^/gm,"    ")}else{u.before+="    "}}else{u.selection=u.selection.replace(/^(?:[ ]{4}|[ ]{0,3}\t)/gm,"")}}}else{u.trimWhitespace();u.findTags(/`/,/`/);if(!u.startTag&&!u.endTag){u.startTag=u.endTag="`";if(!u.selection){u.selection=this.getString("codeexample")}}else{if(u.endTag&&!u.startTag){u.before+=u.endTag;u.endTag=""}else{u.startTag=u.endTag=""}}}};c.doList=function(v,E,z){var G=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/;var A=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/;var u="-";var D=1;var w=function(){var I;if(z){I=" "+D+". ";D++}else{I=" "+u+" "}return I};var x=function(I){if(z===undefined){z=/^\s*\d/.test(I)}I=I.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(J){return w()});return I};v.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null);if(v.before&&!/\n$/.test(v.before)&&!/^\n/.test(v.startTag)){v.before+=v.startTag;v.startTag=""}if(v.startTag){var y=/\d+[.]/.test(v.startTag);v.startTag="";v.selection=v.selection.replace(/\n[ ]{4}/g,"\n");this.unwrap(v);v.skipLines();if(y){v.after=v.after.replace(A,x)}if(z==y){return}}var C=1;v.before=v.before.replace(G,function(I){if(/^\s*([*+-])/.test(I)){u=m.$1}C=/[^\n]\n\n[^\n]/.test(I)?1:0;return x(I)});if(!v.selection){v.selection=this.getString("litem")}var F=w();var B=1;v.after=v.after.replace(A,function(I){B=/[^\n]\n\n[^\n]/.test(I)?1:0;return x(I)});v.trimWhitespace(true);v.skipLines(C,B,true);v.startTag=F;var H=F.replace(/./g," ");this.wrap(v,n.lineLength-H.length);v.selection=v.selection.replace(/\n/g,"\n"+H)};c.doHeading=function(u,z){u.selection=u.selection.replace(/\s+/g," ");u.selection=u.selection.replace(/(^\s+|\s+$)/g,"");if(!u.selection){u.startTag="## ";u.selection=this.getString("headingexample");u.endTag=" ##";return}var w=0;u.findTags(/#+[ ]*/,/[ ]*#+/);if(/#+/.test(u.startTag)){w=m.lastMatch.length}u.startTag=u.endTag="";u.findTags(null,/\s?(-+|=+)/);if(/=+/.test(u.endTag)){w=1}if(/-+/.test(u.endTag)){w=2}u.startTag=u.endTag="";u.skipLines(1,1);var x=w==0?2:w-1;if(x>0){var v=x>=2?"-":"=";var y=u.selection.length;if(y>n.lineLength){y=n.lineLength}u.endTag="\n";while(y--){u.endTag+=v}}};c.doHorizontalRule=function(u,v){u.startTag="----------\n";u.selection="";u.skipLines(2,1,true)}})();